/*****************
Settings
*****************/

var paddingR = 50;
var paddingL = 100;
var paddingT = 35;
var paddingB = 70;
var radius= 20;


// Data
var rawData = ["2014/07/14","2014/07/13","2014/07/26","2014/07/26","2014/08/04","2014/10/10","2014/10/24","2014/07/26","2014/08/03","2014/11/24","2014/01/24","2014/09/21","2014/09/18","2014/11/27","2014/11/26","2014/11/08","2014/10/11","2014/09/01","2014/09/05","2014/09/26","2014/11/01","2014/09/11","2014/10/15","2014/11/08","2015/06/06","2014/08/11","2014/09/12","2015/03/20","2014/11/07","2014/08/02","2014/08/03","2014/10/10","2014/10/11","2014/10/17","2014/10/18","2014/10/24","2014/10/25","2014/11/21","2014/11/22","2014/11/07","2014/11/08","2014/11/14","2014/11/15","2014/11/21","2014/11/22","2014/11/28","2014/11/29","2014/08/21","2014/08/23","2014/08/24","2014/10/31","2014/11/01","2014/01/02","2014/08/30","2014/09/10","2014/10/22","2014/11/26","2014/12/17","2014/09/20","2014/09/07","2014/07/14","2014/07/21","2014/07/28","2014/08/04","2014/08/11","2014/08/18","2014/08/04","2014/08/11","2014/08/04","2014/08/05","2014/07/19","2014/09/08","2014/10/30","2014/08/16","2014/09/01","2014/09/05","2014/09/08","2014/09/19","2014/10/03","2014/10/17","2014/11/14","2015/02/20","2015/03/20","2015/03/25","2014/08/16","2014/08/18","2014/08/18","2014/08/19","2014/08/21","2014/08/22","2014/08/23","2014/08/27","2014/08/30","2014/12/27","2014/07/05","2014/08/20","2014/08/23","2014/09/30","2014/09/01","2014/09/01","2014/09/15","2014/09/01","2014/09/03","2014/09/04","2014/09/03","2014/09/03","2014/10/01","2014/11/20","2014/03/13","2014/03/08","2014/09/09","2014/11/25","2014/09/27","2014/09/20","2014/09/27","2014/03/22","2014/03/27","2014/03/28","2014/04/05","2014/10/24","2014/04/05","2014/04/12","2014/09/13","2014/10/11","2014/11/01","2014/12/13","2015/01/10","2014/10/04","2014/10/24","2014/10/31","2014/03/29","2014/09/13","2014/09/20","2014/10/03","2014/10/25","2014/11/28","2014/08/02","2014/11/29","2014/11/28","2015/03/28","2014/06/06","2014/04/04","2014/07/27","2014/04/05","2014/09/12","2014/09/13","2015/05/13","2015/07/18","2015/07/25","2015/08/01","2014/08/23","2014/10/04","2014/10/11","2014/10/04","2014/10/03","2014/10/04","2014/10/04","2014/10/04","2014/10/04","2014/10/04","2014/10/17","2014/12/26","2014/09/08","2014/09/19","2014/08/27","2014/09/03","2014/09/10","2014/09/09","2014/09/16","2014/09/23","2014/09/30","2014/09/10","2014/10/15","2014/11/12","2014/12/10","2014/09/17","2014/09/24","2014/10/01","2014/10/08","2014/10/01","2014/10/08","2014/10/15","2014/10/22","2014/10/02","2014/10/09","2014/10/16","2014/10/30","2014/10/09","2014/10/23","2014/11/06","2014/11/20","2014/10/09","2014/10/16","2014/10/23","2014/10/30","2014/10/15","2014/11/05","2014/11/12","2014/11/19","2014/10/21","2014/11/04","2014/11/11","2014/12/02","2014/10/24","2014/10/31","2014/11/21","2014/11/28","2014/08/27","2014/09/03","2014/09/10","2014/09/17","2014/09/24","2014/10/01","2014/10/08","2014/10/28","2014/10/29","2014/10/11","2014/09/13","2014/11/22","2014/09/05","2014/09/26","2014/10/24","2014/11/14","2014/09/11","2014/09/12","2014/09/16","2014/09/19","2014/09/22","2014/10/10","2014/11/28","2015/05/01","2014/10/16","2014/08/18","2014/09/05","2014/09/19","2014/09/26","2014/10/16","2014/04/12","2014/10/04","2014/10/31","2014/11/14","2014/05/10","2014/06/14","2014/10/01","2014/08/29","2014/08/30","2014/09/01","2014/09/02","2014/09/02","2014/09/03","2014/09/03","2014/09/03","2014/06/28","2014/04/12","2014/09/06","2014/09/06","2014/09/06","2014/09/06","2014/09/06","2014/09/07","2014/09/07","2014/09/08","2014/09/08","2014/09/08","2014/09/09","2014/09/09","2014/09/11","2014/09/13","2014/09/14","2014/09/14","2014/10/12","2014/11/09","2014/12/14","2014/09/15","2014/10/13","2014/11/17","2014/09/17","2014/09/17","2014/09/19","2014/09/2"];


var days = [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ];
var months = [ 'Jan', 'Feb', 'Mar', 'Apr',  'May', 'June',  'July', 'Aug', 'Sept', 'Okt', 'Nov', 'Dec' ];

// gets a number between 0-6 as argument, 0 represents sunday
// returns the name of the day
var returnDayName = function (dayNumber) {
  return days[dayNumber];
}


// array containing all Date objects for every event
var data = [];

// looping through all the data, creating an object containing the date
for (var i = 0; i < rawData.length; i++) {
  // Converting datestring into Date object and pushing it into data[]
  var date = new Date(rawData[i]);
  data.push(date);
};

// create empty array for days containing freq in months
var freq = [];
for (var day = 0; day < 7; day++) {
  var monthfreq = [];
  for (var month = 0; month < 12; month++) {
    monthfreq.push(0);
  }
  freq.push(monthfreq);
}

// loop through data and count the days in the month
for (var i = 0; i < data.length; i++) {
  var day = data[i].getDay();
  var month = data[i].getMonth();

  freq[day][month]++;
}

var values = [];

for (var i = 0; i < freq.length; i++) {
  for (var j = 0; j < freq[i].length; j++) {
    values.push(freq[i][j]);
  }
}


var sunday = freq[0];

/*******************
*
* Actual data visualisation
*
********************/

var valueScale = d3.scale.linear();
valueScale.domain([0, d3.max(values, function (d) { return d; }) ])
  .range([0, radius]);


var svg = d3.select("body")
            .append('svg')
              .attr('id', 'data-vis');

var h = document.getElementById('data-vis').clientHeight;
var w = document.getElementById('data-vis').clientWidth;

var g = svg.selectAll("g")
    .data(freq)
  .enter().append("g");

  g.attr("transform", function (d, i) {
    var y = 0;
    return 'translate(0, ' +(i * (h - paddingT - paddingB) / (days.length-1)) + ')'; // space rows equally over height - paddings
  });

var circle = g.selectAll("circles")
    .data(function(d, i) { return d; }) // d = freq[i]
  .enter().append("circle")
    .attr("cy", paddingT)
    .attr("cx", function (d, i) { return i *  (w - paddingR - paddingL) / (months.length-1) + paddingL; })
    .attr("r", function (d, i) { return valueScale(d); });

// Scale for X axis
var xScale = d3.scale.ordinal();
xScale.domain(months)
    .rangePoints([paddingL, w - paddingR]);

// Scale for Y axis
var yScale = d3.scale.ordinal();
yScale.domain(days)
    .rangePoints([paddingT, h - paddingB]);

// create X axis
var xAxis = d3.svg.axis()
          .scale(xScale);

// Create y Axis
var yAxis = d3.svg.axis()
          .scale(yScale)
          .orient("left");

// Draw x axis
svg.append('g')
          .attr('class', 'axis x')
          .attr('transform', 'translate(0,' + (h - paddingT) + ')')
          .call(xAxis);

// draw y axis
svg.append('g')
          .attr('class', 'axis y')
          .attr('transform', 'translate(' + (paddingL/3)*2 + ')')
          .call(yAxis);
